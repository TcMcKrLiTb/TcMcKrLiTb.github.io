define(["./_chunks/vendor-fee82cbd"],(function(e){"use strict";var i={cs:{Download:"Stáhnout","Loading folder failed…":"Načítání složky selhalo...",of:"ze"},de:{Close:"Schließen",Download:"Herunterladen","Failed to load media":"Laden der Medien fehlgeschlagen","Loading folder failed…":"Laden des Ordners fehlgeschlagen…","Loading media":"Lade Daten",Next:"Nächstes",of:"von",Previous:"Vorheriges"},es:{Download:"Descargar","Loading folder failed…":"Falló la subida de la carpeta...",of:"de"},fr:{Download:"Télécharger","Loading folder failed…":"Erreur de chargement du dossier…",of:"sur"},gl:{Download:"Descargar","Loading folder failed…":"Produciuse un fallo ao cargar o cartafol…",of:"de"},it:{}};const t={name:"Mediaviewer",mixins:[{computed:{...e.mapGetters$2("Files",["publicLinkPassword"]),...e.mapGetters$2(["configuration"]),$_loader_publicContext(){return!this.isAuthenticated},$_loader_folderLoading(){return this.$_internal_loader_folderLoading}},data:()=>({$_internal_loader_folderLoading:!0}),methods:{...e.mapActions$2("Files",["loadFolder"]),$_loader_loadFolder(e,i){if(""===this.$store.getters.activeFile.path&&"public-files"===e){const e=this.$route.params.filePath.substring(1),i=e.substr(0,e.indexOf("/"));throw this.$nextTick((()=>{this.$router.push({name:"publicLink",params:{token:i}})})),new Error("public-files")}if(""===this.$store.getters.activeFile.path){const t=i.substring(1,i.lastIndexOf("/"));return this.loadFolder({client:this.$client,absolutePath:t,$gettext:this.$gettext,routeName:e,loadSharesTree:!this.publicPage()}).then((()=>{this.$data.$_internal_loader_folderLoading=!1})).catch((e=>{this.showMessage({title:this.$gettext("Loading folder failed…"),desc:e.message,status:"danger",autoClose:{enabled:!0}})}))}this.$data.$_internal_loader_folderLoading=!1},$_loader_getDavFilePath(i,t=null){const a=t?e.queryString.stringify(t):"";if(!this.$_loader_publicContext){const e=["..","dav","files",this.$store.getters.user.id,i.path].join("/");return[this.$client.files.getFileUrl(e),a].filter(Boolean).join("?")}if(!i.downloadURL){const e=["..","dav","public-files",i.path].join("/");return[this.$client.files.getFileUrl(e),a].filter(Boolean).join("?")}const[s,o]=i.downloadURL.split("?");return[s,[a,encodeURIComponent(o)].filter(Boolean).join("&")].filter(Boolean).join("?")},$_loader_headers(){if(!this.$_loader_publicContext)return null;const i=new Headers;i.append("X-Requested-With","XMLHttpRequest");const t=this.publicLinkPassword;return t&&i.append("Authorization","Basic "+e.Buffer.from("public:"+t).toString("base64")),i},$_loader_navigateToContextRoute(i,t){this.$router.push({name:i,params:{item:e.dirname(t)||"/"},query:{scrollTo:e.basename(t)}})}}}],data:()=>({loading:!0,failed:!1,activeIndex:null,direction:"rtl",medium:{},media:[],animationDuration:1e3}),computed:{...e.mapGetters$2("Files",["activeFiles"]),...e.mapGetters$2(["getToken","capabilities"]),mediaFiles(){return this.activeFiles.filter((e=>e.extension.toLowerCase().match(/(png|jpg|jpeg|gif|mp4|webm|ogg)/)))},activeMediaFile(){return this.mediaFiles[this.activeIndex]},activeMediaFileCached(){const e=this.media.find((e=>e.id===this.activeMediaFile.id));return void 0!==e&&e},activeClass(){const e=["right","left"];return"ltr"===this.direction&&e.reverse(),{enter:`uk-animation-slide-${e[0]}-small`,leave:`uk-animation-slide-${e[1]} uk-animation-reverse`}},thumbDimensions(){switch(!0){case window.innerWidth<=1024:return 1024;case window.innerWidth<=1280:return 1280;case window.innerWidth<=1920:return 1920;case window.innerWidth<=2160:return 2160;default:return 3840}},thumbUrl(){const e={x:this.thumbDimensions,y:this.thumbDimensions,c:this.activeMediaFile.etag.substr(1,this.activeMediaFile.etag.length-2),scalingup:0,preview:1,a:1};return this.$_loader_getDavFilePath(this.activeMediaFile,e)},rawMediaUrl(){return this.$_loader_getDavFilePath(this.activeMediaFile)},videoExtensions:()=>["mp4","webm","ogg"],isActiveMediaFileTypeVideo(){return this.videoExtensions.includes(this.activeMediaFile.extension)},isActiveMediaFileTypeImage(){return!this.isActiveMediaFileTypeVideo},isUrlSigningEnabled(){return this.capabilities.core&&this.capabilities.core["support-url-signing"]}},watch:{activeIndex(e,i){e!==i&&this.loadMedium()}},async mounted(){document.addEventListener("keyup",this.handleKeyPress),window.addEventListener("popstate",this.handleLocalHistoryEvent);const e=this.$route.params.filePath;await this.$_loader_loadFolder(this.$route.params.contextRouteName,e),this.setCurrentFile(e)},beforeDestroy(){document.removeEventListener("keyup",this.handleKeyPress),window.removeEventListener("popstate",this.handleLocalHistoryEvent),this.media.forEach((e=>{window.URL.revokeObjectURL(e.url)}))},methods:{setCurrentFile(e){for(let i=0;i<this.mediaFiles.length;i++)if(this.mediaFiles[i].path===e){this.activeIndex=i;break}},handleLocalHistoryEvent(){const e=this.$router.resolve(document.location);this.setCurrentFile(e.route.params.filePath)},updateLocalHistory(){this.$route.params.filePath=this.activeMediaFile.path,history.pushState({},document.title,this.$router.resolve(this.$route).href)},loadMedium(){if(this.loading=!0,this.activeMediaFileCached)return void setTimeout((()=>{this.medium=this.activeMediaFileCached,this.loading=!1}),this.animationDuration/2);const e=this.isActiveMediaFileTypeImage?this.thumbUrl:this.rawMediaUrl;let i;i=this.isActiveMediaFileTypeImage||!this.isUrlSigningEnabled?this.mediaSource(decodeURIComponent(e),"url",null):this.$client.signUrl(e,86400),i.then((e=>{this.media.push({id:this.activeMediaFile.id,name:this.activeMediaFile.name,url:e,ext:this.activeMediaFile.extension,isVideo:this.isActiveMediaFileTypeVideo,isImage:this.isActiveMediaFileTypeImage}),this.medium=this.activeMediaFileCached,this.loading=!1,this.failed=!1})).catch((e=>{this.loading=!1,this.failed=!0,console.error(e)}))},downloadMedium(){if(!this.loading)return this.downloadFile(this.mediaFiles[this.activeIndex],this.$_loader_publicContext)},next(){this.loading||(this.direction="rtl",this.activeIndex+1>=this.mediaFiles.length?this.activeIndex=0:(this.activeIndex++,this.updateLocalHistory()))},prev(){this.loading||(this.direction="ltr",0!==this.activeIndex?(this.activeIndex--,this.updateLocalHistory()):this.activeIndex=this.mediaFiles.length-1)},handleKeyPress(e){if(!e)return!1;"ArrowRight"===e.key?this.next():"ArrowLeft"===e.key&&this.prev()},closeApp(){this.$_loader_navigateToContextRoute(this.$route.params.contextRouteName,this.$route.params.filePath)}}};var a=function(){var e=this,i=e.$createElement,t=e._self._c||i;return t("main",{staticClass:"uk-position-relative",attrs:{id:"mediaviewer"}},[t("div",{staticClass:"uk-text-center oc-p-s"},[t("transition",{attrs:{name:"custom-classes-transition","enter-active-class":e.activeClass.enter,"leave-active-class":e.activeClass.leave}},[t("div",{directives:[{name:"show",rawName:"v-show",value:!e.loading&&e.activeMediaFileCached,expression:"!loading && activeMediaFileCached"}]},[e.medium.isVideo?t("video",{key:"media-video-"+e.medium.id,staticClass:"uk-box-shadow-medium media-viewer-player",attrs:{controls:"",preload:""}},[t("source",{attrs:{src:e.medium.url,type:"video/"+e.medium.ext}})]):t("img",{key:"media-image-"+e.medium.id,staticClass:"uk-box-shadow-medium media-viewer-player",attrs:{src:e.medium.url,alt:e.medium.name,"data-id":e.medium.id}})])])],1),e._v(" "),e.loading?t("oc-spinner",{staticClass:"uk-position-center",attrs:{"aria-label":e.$gettext("Loading media"),size:"xlarge"}}):e._e(),e._v(" "),e.failed?t("oc-icon",{staticClass:"uk-position-center uk-z-index",attrs:{name:"review",variation:"danger",size:"xlarge","accessible-label":e.$gettext("Failed to load media")}}):e._e(),e._v(" "),t("div",{staticClass:"uk-position-medium uk-position-bottom-center media-viewer-details"},[t("div",{staticClass:"uk-overlay uk-overlay-default oc-p-s uk-text-center oc-text-muted uk-text-truncate media-viewer-file-name"},[e._v("\n      "+e._s(e.medium.name)+"\n    ")]),e._v(" "),t("div",{staticClass:"uk-overlay uk-overlay-primary uk-light oc-p-s media-viewer-controls-container"},[t("div",{staticClass:"uk-width-large uk-flex uk-flex-middle uk-flex-center uk-flex-around media-viewer-controls-action-bar",staticStyle:{"user-select":"none"}},[t("oc-icon",{staticClass:"oc-cursor-pointer media-viewer-controls-previous",attrs:{role:"button",size:"large",name:"chevron_left","accessible-label":e.$gettext("Previous")},on:{click:e.prev}}),e._v(" "),e.$_loader_folderLoading?e._e():t("span",{staticClass:"uk-text-small",staticStyle:{color:"#fff"}},[e._v("\n          "+e._s(e.activeIndex+1)+" "),t("span",{directives:[{name:"translate",rawName:"v-translate"}]},[e._v("of")]),e._v(" "+e._s(e.mediaFiles.length)+"\n        ")]),e._v(" "),t("oc-icon",{staticClass:"oc-cursor-pointer media-viewer-controls-next",attrs:{role:"button",size:"large",name:"chevron_right","accessible-label":e.$gettext("Next")},on:{click:e.next}}),e._v(" "),t("oc-icon",{staticClass:"oc-cursor-pointer media-viewer-controls-download",attrs:{role:"button",name:"file_download","accessible-label":e.$gettext("Download")},on:{click:e.downloadMedium}}),e._v(" "),t("oc-icon",{staticClass:"oc-cursor-pointer media-viewer-controls-close",attrs:{role:"button",name:"close","accessible-label":e.$gettext("Close")},on:{click:e.closeApp}})],1)])])],1)};a._withStripped=!0;return{appInfo:{name:"Mediaviewer",id:"mediaviewer",icon:"image",extensions:[{extension:"png",routeName:"mediaviewer-media",routes:["files-personal","files-favorites","files-shared-with-others","files-shared-with-me","files-public-list"]},{extension:"jpg",routeName:"mediaviewer-media",routes:["files-personal","files-favorites","files-shared-with-others","files-shared-with-me","files-public-list"]},{extension:"jpeg",routeName:"mediaviewer-media",routes:["files-personal","files-favorites","files-shared-with-others","files-shared-with-me","files-public-list"]},{extension:"gif",routeName:"mediaviewer-media",routes:["files-personal","files-favorites","files-shared-with-others","files-shared-with-me","files-public-list"]},{extension:"mp4",routeName:"mediaviewer-media",routes:["files-personal","files-favorites","files-shared-with-others","files-shared-with-me","files-public-list"]},{extension:"webm",routeName:"mediaviewer-media",routes:["files-personal","files-favorites","files-shared-with-others","files-shared-with-me","files-public-list"]},{extension:"ogg",routeName:"mediaviewer-media",routes:["files-personal","files-favorites","files-shared-with-others","files-shared-with-me","files-public-list"]}]},routes:[{path:"/:contextRouteName/:filePath",components:{app:e.normalizeComponent({render:a,staticRenderFns:[]},undefined,t,"data-v-5300b447",false,undefined,!1,void 0,void 0,void 0)},name:"media",meta:{auth:!1}}],translations:i}}));
